# 控糖App开发计划

## 项目概述
开发一款基于Flutter的跨平台控糖App，核心功能包括食物识别、营养分析、控糖建议和血糖记录。

## 技术栈
- **前端框架**：Flutter（跨平台iOS + Android）
- **状态管理**：Riverpod（轻量、易用）
- **网络请求**：Dio（强大的HTTP客户端）
- **图片处理**：image_picker（相机拍照）、image_cropper（图片裁剪）
- **数据存储**：shared_preferences（本地存储）、sqflite（本地数据库）
- **图表展示**：fl_chart（血糖曲线、营养数据可视化）
- **食物识别API**：FatSecret Platform API（全球覆盖，支持中文）或天聚数行TianAPI（中国本土食物）
- **营养数据库**：API自带或结合中国食物成分表

## 项目结构
```
lib/
├── main.dart              # 应用入口
├── src/
│   ├── models/            # 数据模型
│   │   ├── food.dart      # 食物模型
│   │   ├── nutrition.dart # 营养数据模型
│   │   └── blood_sugar.dart # 血糖记录模型
│   ├── screens/           # 页面组件
│   │   ├── home_screen.dart     # 首页
│   │   ├── camera_screen.dart   # 拍照页面
│   │   ├── food_result_screen.dart # 识别结果页面
│   │   ├── blood_sugar_screen.dart # 血糖记录页面
│   │   └── report_screen.dart    # 报告页面
│   ├── services/          # 业务逻辑和API调用
│   │   ├── food_recognition_service.dart # 食物识别API
│   │   ├── nutrition_service.dart # 营养计算
│   │   └── blood_sugar_service.dart # 血糖记录管理
│   ├── widgets/           # 自定义组件
│   │   ├── food_card.dart        # 食物卡片
│   │   ├── nutrition_display.dart # 营养数据展示
│   │   ├── blood_sugar_chart.dart # 血糖曲线
│   │   └── suggestion_card.dart  # 控糖建议卡片
│   ├── utils/             # 工具函数
│   │   ├── constants.dart # 常量定义
│   │   ├── diabetes_guide.dart # 糖尿病指南数据
│   │   └── formatter.dart # 数据格式化
│   └── providers/         # 状态管理
│       ├── food_provider.dart    # 食物识别状态
│       ├── nutrition_provider.dart # 营养数据状态
│       └── blood_sugar_provider.dart # 血糖记录状态
```

## 核心功能实现

### 1. 食物拍照与上传
- 使用`image_picker`插件实现相机拍照和相册选择
- 支持图片裁剪和压缩，优化上传速度
- 实现图片预览和确认功能

### 2. AI食物识别
- 集成食物识别API（FatSecret或天聚数行）
- 处理API响应，解析食物种类、份量和营养数据
- 支持手动调整识别结果和份量

### 3. 营养计算与控糖建议
- 根据识别结果计算总糖、添加糖、碳水化合物和热量
- 结合中国糖尿病学会指南，生成个性化控糖建议
- 展示详细营养成分和建议理由

### 4. 血糖记录功能
- 实现血糖值手动输入
- 支持记录时间、状态（餐前/餐后）
- 本地存储血糖历史数据

### 5. 数据可视化
- 使用`fl_chart`绘制血糖变化曲线
- 实现每日/每周/每月血糖趋势分析
- 生成营养摄入和血糖变化的每日报告

## 开发步骤

1. **项目初始化**
   - 创建Flutter项目
   - 配置依赖包和项目结构
   - 设置API密钥和环境变量

2. **基础功能开发**
   - 实现底部导航栏（首页、拍照、血糖记录、报告）
   - 开发相机拍照和图片上传功能
   - 搭建本地数据库，实现数据持久化

3. **核心功能实现**
   - 集成食物识别API
   - 开发营养计算和控糖建议逻辑
   - 实现血糖记录和查询功能

4. **数据可视化开发**
   - 实现血糖曲线绘制
   - 开发每日报告生成功能
   - 优化UI/UX设计

5. **测试与优化**
   - 单元测试和集成测试
   - 性能优化（图片加载、API调用）
   - 跨平台适配和兼容性测试

## API集成方案

### 推荐API：FatSecret Platform API
- **优势**：全球覆盖，支持中文，自动估算份量和营养
- **主要接口**：
  - `foods.search`：搜索食物
  - `food.get`：获取食物详情和营养数据
  - 图片识别需通过上传图片URL到服务器，再调用API识别

### 备用API：天聚数行TianAPI
- **优势**：中国本土食物覆盖，直接识别2000+种常见食物
- **主要接口**：
  - `food/nutrition`：食物营养识别
  - `food/ingredient`：食物成分分析

## 关键技术点

1. **图片上传优化**
   - 实现图片压缩，控制上传大小
   - 添加上传进度显示
   - 处理网络异常和重试机制

2. **状态管理**
   - 使用Riverpod管理全局状态
   - 实现API调用状态（加载中、成功、失败）
   - 管理用户输入和交互状态

3. **离线支持**
   - 缓存常用食物营养数据
   - 支持离线查看历史记录
   - 网络恢复后自动同步数据

4. **隐私保护**
   - 本地存储用户数据，不上传敏感信息
   - 实现数据加密存储
   - 提供数据导出和删除功能

## 预期成果

- 完成跨平台控糖App开发
- 实现核心功能：食物识别、营养分析、控糖建议、血糖记录
- 提供良好的用户体验和视觉设计
- 支持中文界面和中国糖尿病指南
- 实现数据可视化和报告生成

## 后续优化方向

- 添加用户认证和云同步功能
- 支持多用户使用
- 集成更多健康数据（血压、体重等）
- 实现智能预测和个性化推荐
- 添加社区功能，支持用户交流和分享
